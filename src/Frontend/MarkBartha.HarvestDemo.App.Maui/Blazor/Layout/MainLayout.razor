@inherits LayoutComponentBase
@inject NavigationManager Navigation

<div class="desktop-grid">
    <!-- Sidebar -->
    <Sidebar IsOpen="@isSidebarOpen" OnClose="() => isSidebarOpen = false" />

    <!-- Main area -->
    <div class="flex flex-col min-h-screen">
        <!-- Header -->
        <Header Title="@headerTitle"
                ShowBack="false"
                ShowNotification="true"
                OnToggleSidebar="() => isSidebarOpen = true">
        </Header>

        @Body
    </div>
</div>

@code {
    private bool isSidebarOpen;
    private string headerTitle = "Tasks";

    protected override void OnInitialized()
    {
        UpdateHeaderTitle(Navigation.Uri);
        Navigation.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        UpdateHeaderTitle(e.Location);
        StateHasChanged();
    }

    private void UpdateHeaderTitle(string uri)
    {
        var relative = Navigation.ToBaseRelativePath(uri);

        if (string.IsNullOrEmpty(relative) || relative.StartsWith("dashboard", StringComparison.OrdinalIgnoreCase))
        {
            headerTitle = "Tasks";
        }
        else
        {
            headerTitle = "Forespend";
        }
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= HandleLocationChanged;
    }
}
